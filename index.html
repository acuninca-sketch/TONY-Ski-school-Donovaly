<!DOCTYPE html>
<html lang="sk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Rezerv√°cia lekcie - Ly≈æiarska ≈°kola</title>
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #000;
      color: #fff;
      margin: 0;
      padding: 0;
    }

    h1 {
      text-align: center;
      padding: 20px;
    }

    .container {
      padding: 15px;
      max-width: 900px;
      margin: auto;
    }

    .filters {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-bottom: 15px;
    }

    @media(min-width: 600px) {
      .filters {
        flex-direction: row;
        justify-content: space-between;
      }
    }

    select, input[type="date"] {
      padding: 10px;
      border-radius: 8px;
      border: none;
      width: 100%;
      background: #222;
      color: #fff;
    }

    .legend {
      display: flex;
      gap: 15px;
      margin: 10px 0 20px;
      font-size: 14px;
    }

    .legend span {
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .circle {
      width: 14px;
      height: 14px;
      border-radius: 50%;
      display: inline-block;
    }

    .free { background: green; }
    .selected { background: gold; }
    .booked { background: red; }

    .time-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }

    .time-slot {
      padding: 15px;
      border-radius: 12px;
      text-align: center;
      font-weight: bold;
      cursor: pointer;
      background: green;
      color: #fff;
    }

    .time-slot.selected {
      background: gold;
      color: #000;
    }

    .time-slot.booked {
      background: red;
      cursor: not-allowed;
    }

    .form-container {
      background: #111;
      padding: 20px;
      border-radius: 12px;
      margin-top: 25px;
    }

    .form-container h3 {
      margin-bottom: 10px;
    }

    label {
      display: block;
      margin-top: 10px;
    }

    input, textarea {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      border-radius: 8px;
      border: none;
      background: #222;
      color: #fff;
    }

    button {
      margin-top: 20px;
      width: 100%;
      padding: 14px;
      background: #0a84ff;
      border: none;
      border-radius: 12px;
      color: #fff;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
    }

    .cennik-btn {
      display: block;
      margin-top: 15px;
      text-align: center;
      padding: 12px;
      background: #333;
      border-radius: 12px;
      color: #fff;
      font-weight: bold;
      text-decoration: none;
      cursor: pointer;
    }

    .cennik-btn:hover {
      background: #444;
    }

    /* Popup ≈°t√Ωly */
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background: rgba(0,0,0,0.8);
    }

    .modal-content {
      background: #1a1a1a;
      margin: 10% auto;
      padding: 20px;
      border-radius: 12px;
      width: 90%;
      max-width: 600px;
      color: #fff;
      box-shadow: 0 5px 15px rgba(0,0,0,0.5);
    }

    .close {
      color: #aaa;
      float: right;
      font-size: 28px;
      font-weight: bold;
      cursor: pointer;
    }

    .close:hover {
      color: #fff;
    }
  </style>
</head>
<body>
  <h1>Rezerv√°cia lekcie</h1>

  <div class="container">
    <!-- V√Ωber d√°tumu a lekcie -->
    <div class="filters">
      <div>
        <label for="date">D√°tum</label>
        <input type="date" id="date">
      </div>
      <div>
        <label for="sport">Typ lekcie</label>
        <select id="sport">
          <option value="lyze">Ly≈æe</option>
          <option value="snb">Snowboard</option>
        </select>
      </div>
    </div>

    <!-- Legenda -->
    <div class="legend">
      <span><span class="circle free"></span> Voƒæn√©</span>
      <span><span class="circle selected"></span> Vybrat√©</span>
      <span><span class="circle booked"></span> Zarezervovan√©</span>
    </div>

    <!-- V√Ωber hod√≠n -->
    <div class="time-grid" id="timeGrid"></div>

    <!-- Formul√°r -->
    <div class="form-container">
      <h3>Rezervaƒçn√Ω formul√°r</h3>
      <label>Meno a priezvisko</label>
      <input type="text" id="name">
      <label>Telef√≥n</label>
      <input type="text" id="phone">
      <label>Email</label>
      <input type="email" id="email">
      <label>Pozn√°mka</label>
      <textarea id="note"></textarea>
      <button id="submitReservation">üìå Rezervova≈• vybrat√© hodiny</button>
      <div class="cennik-btn" id="openCennik">üìã Cenn√≠k</div>
    </div>
  </div>

  <!-- Popup Cenn√≠k -->
  <div id="cennikModal" class="modal">
    <div class="modal-content">
      <span class="close" id="closeCennik">&times;</span>
      <h2>üìã Cenn√≠k</h2>
      <div id="cennikContent">Naƒç√≠tavam...</div>
    </div>
  </div>

  <script>
    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyCf1STUPCcqzuTefIgo2Rca49vpNJY4",
      authDomain: "lyziarska-skola.firebaseapp.com",
      projectId: "lyziarska-skola",
      storageBucket: "lyziarska-skola.appspot.com",
      messagingSenderId: "59575233692",
      appId: "1:59575233692:web:c84584d064fc8a79db59",
      measurementId: "G-KRT4ECRERK"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const times = [
      "09:00 - 09:55",
      "10:00 - 10:55",
      "11:00 - 11:55",
      "12:00 - 12:55",
      "13:30 - 14:25",
      "14:30 - 15:25",
      "15:30 - 16:25",
      "16:30 - 17:25",
      "17:30 - 18:25",
      "18:30 - 19:25"
    ];

    const timeGrid = document.getElementById("timeGrid");
    const dateInput = document.getElementById("date");
    const sportSelect = document.getElementById("sport");
    let selectedSlots = [];

    function renderSlots(bookedSlots=[]) {
      timeGrid.innerHTML = "";
      times.forEach(time => {
        const div = document.createElement("div");
        div.classList.add("time-slot");
        div.innerText = time;

        if (bookedSlots.includes(time)) {
          div.classList.add("booked");
        } else {
          div.addEventListener("click", () => {
            if (div.classList.contains("selected")) {
              div.classList.remove("selected");
              selectedSlots = selectedSlots.filter(t => t !== time);
            } else {
              div.classList.add("selected");
              selectedSlots.push(time);
            }
          });
        }
        timeGrid.appendChild(div);
      });
    }

    async function loadReservations() {
      const date = dateInput.value;
      const sport = sportSelect.value;
      if (!date) return;
      const snapshot = await db.collection("rezervacie")
        .where("date", "==", date)
        .where("sport", "==", sport)
        .get();
      let booked = [];
      snapshot.forEach(doc => {
        booked = booked.concat(doc.data().slots || []);
      });
      renderSlots(booked);
    }

    dateInput.addEventListener("change", loadReservations);
    sportSelect.addEventListener("change", loadReservations);

    document.getElementById("submitReservation").addEventListener("click", async () => {
      const name = document.getElementById("name").value;
      const phone = document.getElementById("phone").value;
      const email = document.getElementById("email").value;
      const note = document.getElementById("note").value;
      const date = dateInput.value;
      const sport = sportSelect.value;

      if (!name || !phone || !email || selectedSlots.length === 0) {
        alert("Vypl≈àte v≈°etky √∫daje a vyberte hodiny.");
        return;
      }

      await db.collection("rezervacie").add({
        name, phone, email, note, date, sport,
        slots: selectedSlots,
        createdAt: new Date()
      });

      alert("Rezerv√°cia √∫spe≈°n√°!");
      selectedSlots = [];
      loadReservations();
    });

    // Default dne≈°n√Ω d√°tum
    dateInput.valueAsDate = new Date();
    loadReservations();

    // Popup logika
    const modal = document.getElementById("cennikModal");
    const openBtn = document.getElementById("openCennik");
    const closeBtn = document.getElementById("closeCennik");
    const cennikContent = document.getElementById("cennikContent");

    openBtn.onclick = async () => {
      modal.style.display = "block";
      try {
        const resp = await fetch("cennik-admin.html");
        const text = await resp.text();
        const parser = new DOMParser();
        const doc = parser.parseFromString(text, "text/html");
        const publicCennik = doc.querySelector("#publicCennik");
        if (publicCennik) {
          cennikContent.innerHTML = publicCennik.innerHTML;
        } else {
          cennikContent.innerHTML = "‚ùå Cenn√≠k sa nepodarilo naƒç√≠ta≈•.";
        }
      } catch (e) {
        cennikContent.innerHTML = "‚ö†Ô∏è Chyba pri naƒç√≠tan√≠ cenn√≠ka.";
      }
    };

    closeBtn.onclick = () => modal.style.display = "none";
    window.onclick = (e) => { if (e.target == modal) modal.style.display = "none"; };
    window.addEventListener("keydown", (e) => { if (e.key === "Escape") modal.style.display = "none"; });
  </script>
</body>
</html>
