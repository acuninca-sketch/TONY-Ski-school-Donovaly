<!DOCTYPE html>
<html lang="sk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Rezervácia lekcie - Lyžiarska škola</title>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #000;
      color: #fff;
      margin: 0;
      padding: 0;
    }

    h1 {
      text-align: center;
      padding: 20px;
    }

    .container {
      padding: 15px;
      max-width: 900px;
      margin: auto;
    }

    .filters {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-bottom: 15px;
    }

    @media(min-width: 600px) {
      .filters {
        flex-direction: row;
        justify-content: space-between;
      }
    }

    select, input[type="date"] {
      padding: 10px;
      border-radius: 8px;
      border: none;
      width: 100%;
      background: #222;
      color: #fff;
    }

    .legend {
      display: flex;
      gap: 15px;
      margin: 10px 0 20px;
      font-size: 14px;
    }

    .legend span {
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .circle {
      width: 14px;
      height: 14px;
      border-radius: 50%;
      display: inline-block;
    }

    .free { background: green; }
    .selected { background: gold; }
    .booked { background: red; }

    .time-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }

    .time-slot {
      padding: 15px;
      border-radius: 12px;
      text-align: center;
      font-weight: bold;
      cursor: pointer;
      background: green;
      color: #fff;
    }

    .time-slot.selected { background: gold; color: #000; }
    .time-slot.booked { background: red; cursor: not-allowed; }

    .form-container {
      background: #111;
      padding: 20px;
      border-radius: 12px;
      margin-top: 25px;
    }

    .form-container h3 {
      margin-bottom: 10px;
    }

    label {
      display: block;
      margin-top: 10px;
    }

    input, textarea {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      border-radius: 8px;
      border: none;
      background: #222;
      color: #fff;
    }

    button {
      margin-top: 20px;
      width: 100%;
      padding: 14px;
      background: #0a84ff;
      border: none;
      border-radius: 12px;
      color: #fff;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
    }

    .cennik-btn {
      display: block;
      margin-top: 15px;
      text-align: center;
      padding: 12px;
      background: #333;
      border-radius: 12px;
      color: #fff;
      font-weight: bold;
      text-decoration: none;
    }

    .cennik-btn:hover {
      background: #444;
    }
  </style>
</head>
<body>
  <h1>Rezervácia lekcie</h1>
  <div class="container">

    <!-- Výber dátumu a lekcie -->
    <div class="filters">
      <div>
        <label for="date">Dátum</label>
        <input type="date" id="date">
      </div>
      <div>
        <label for="sport">Typ lekcie</label>
        <select id="sport">
          <option value="lyze">Lyže</option>
          <option value="snb">Snowboard</option>
        </select>
      </div>
    </div>

    <!-- Legenda -->
    <div class="legend">
      <span><span class="circle free"></span> Voľné</span>
      <span><span class="circle selected"></span> Vybraté</span>
      <span><span class="circle booked"></span> Zarezervované</span>
    </div>

    <!-- Výber hodín -->
    <div class="time-grid" id="timeGrid"></div>

    <!-- Formulár -->
    <div class="form-container">
      <h3>Rezervačný formulár</h3>
      <label>Meno a priezvisko</label>
      <input type="text" id="name">

      <label>Telefón</label>
      <input type="text" id="phone">
      <label>Email</label>
      <input type="email" id="email">

      <label>Poznámka</label>
      <textarea id="note"></textarea>

      <button id="reserveBtn">Rezervovať vybraté hodiny</button>
<button id="cennikBtn" onclick="openCennik()">Cenník</button>
    </div>
  </div>

  <script>
    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyCf1STUPCcqzuTefIgo2Rca49vpNJY4",
      authDomain: "lyziarska-skola.firebaseapp.com",
      projectId: "lyziarska-skola",
      storageBucket: "lyziarska-skola.appspot.com",
      messagingSenderId: "59575233692",
      appId: "1:59575233692:web:c84584d064fc8a79db59",
      measurementId: "G-KRT4ECRERK"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const times = [
      "09:00 - 09:55", "10:00 - 10:55",
      "11:00 - 11:55", "12:00 - 12:55",
      "13:30 - 14:25", "14:30 - 15:25",
      "15:30 - 16:25", "16:30 - 17:25",
      "17:30 - 18:25", "18:30 - 19:25"
    ];

    const timeGrid = document.getElementById("timeGrid");
    const dateInput = document.getElementById("date");
    const sportSelect = document.getElementById("sport");
    let selectedSlots = [];

    // render slotov
    function renderSlots(bookedSlots=[]) {
      timeGrid.innerHTML = "";
      times.forEach(time => {
        const div = document.createElement("div");
        div.classList.add("time-slot");
        div.innerText = time;

        if (bookedSlots.includes(time)) {
          div.classList.add("booked");
        } else {
          div.addEventListener("click", () => {
            if (div.classList.contains("selected")) {
              div.classList.remove("selected");
              selectedSlots = selectedSlots.filter(t => t !== time);
            } else {
              div.classList.add("selected");
              selectedSlots.push(time);
            }
          });
        }
        timeGrid.appendChild(div);
      });
    }

    // načítanie rezervácií
    async function loadReservations() {
      const date = dateInput.value;
      const sport = sportSelect.value;
      if (!date) return;

      const snapshot = await db.collection("rezervacie").where("date", "==", date).where("sport", "==", sport).get();
      let booked = [];
      snapshot.forEach(doc => {
        booked = booked.concat(doc.data().slots || []);
      });
      renderSlots(booked);
    }

    dateInput.addEventListener("change", loadReservations);
    sportSelect.addEventListener("change", loadReservations);

    document.getElementById("submitReservation").addEventListener("click", async () => {
      const name = document.getElementById("name").value;
      const phone = document.getElementById("phone").value;
      const email = document.getElementById("email").value;
      const note = document.getElementById("note").value;
      const date = dateInput.value;
      const sport = sportSelect.value;

      if (!name || !phone || !email || selectedSlots.length === 0) {
        alert("Vyplňte všetky údaje a vyberte hodiny.");
        return;
      }

      await db.collection("rezervacie").add({
        name, phone, email, note, date, sport,
        slots: selectedSlots,
        createdAt: new Date()
      });

      alert("Rezervácia úspešná!");
      selectedSlots = [];
      loadReservations();
    });

    // default dnešný dátum
    dateInput.valueAsDate = new Date();
    loadReservations();
  </script>
  <!-- Popup Cenník -->
<div id="cennikModal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeCennik()">&times;</span>
    <div id="cennikContent">Načítavam cenník...</div>
  </div>
</div>

<style>
  .modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0; top: 0;
    width: 100%; height: 100%;
    background-color: rgba(0,0,0,0.8);
    justify-content: center;
    align-items: center;
  }
  .modal-content {
    background: #111;
    color: #fff;
    padding: 20px;
    border-radius: 12px;
    max-width: 600px;
    width: 90%;
    max-height: 80%;
    overflow-y: auto;
    box-shadow: 0 0 20px rgba(255,255,255,0.3);
  }
  .close {
    float: right;
    font-size: 28px;
    cursor: pointer;
  }
</style>

<script>
  async function openCennik() {
    const modal = document.getElementById("cennikModal");
    const content = document.getElementById("cennikContent");

    try {
      const response = await fetch("cennik-admin.html");
      const html = await response.text();
      content.innerHTML = html;
    } catch (error) {
      content.innerHTML = "<p style='color:red;'>Nepodarilo sa načítať cenník.</p>";
    }

    modal.style.display = "flex";
  }

  function closeCennik() {
    document.getElementById("cennikModal").style.display = "none";
  }

  // Zavrie popup kliknutím mimo obsahu
  window.onclick = function(event) {
    const modal = document.getElementById("cennikModal");
    if (event.target === modal) {
      modal.style.display = "none";
    }
  };
</script>

</body>
</html>

