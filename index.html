<!DOCTYPE html>
<html lang="sk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Rezervácia lyžiarskej školy</title>
  <script type="module">
    // Firebase SDK import
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    // Firebase config (toto je z tvojho screenshotu)
    const firebaseConfig = {
      apiKey: "AIzaSyCf1STUPCcqzuTefIgo2Rca49vpNJY4",
      authDomain: "lyziarska-skola.firebaseapp.com",
      projectId: "lyziarska-skola",
      storageBucket: "lyziarska-skola.appspot.com",
      messagingSenderId: "59575233692",
      appId: "1:59575233692:web:c84584d064fc8a79db59",
      measurementId: "G-KRT4ECRERK"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const times = ["9:00","10:00","11:00","12:00","13:00","14:00","15:00"];

    // načítanie rezervácií pre daný deň
    async function loadReserved(date) {
      const tableBody = document.getElementById("times-body");
      tableBody.innerHTML = "";
      const dayDoc = await getDoc(doc(db, "rezervacie", date));
      let reserved = [];
      if (dayDoc.exists()) reserved = dayDoc.data().times;

      times.forEach(time => {
        const row = document.createElement("tr");
        const cell1 = document.createElement("td");
        cell1.textContent = time;
        const cell2 = document.createElement("td");

        if (reserved && reserved.includes(time)) {
          cell2.textContent = "Obsadené";
        } else {
          const checkbox = document.createElement("input");
          checkbox.type = "checkbox";
          checkbox.value = time;
          cell2.appendChild(checkbox);
        }

        row.appendChild(cell1);
        row.appendChild(cell2);
        tableBody.appendChild(row);
      });
    }

    // odoslanie rezervácie
    async function submitReservation(e) {
      e.preventDefault();
      const name = document.getElementById("name").value;
      const phone = document.getElementById("phone").value;
      const date = document.getElementById("date").value;
      const selected = Array.from(document.querySelectorAll("#times-body input:checked")).map(cb => cb.value);

      if (!name || !phone || !date || selected.length === 0) {
        alert("Vyplň všetky údaje a vyber aspoň jednu hodinu!");
        return;
      }

      const dayRef = doc(db, "rezervacie", date);
      const daySnap = await getDoc(dayRef);
      let reserved = [];
      if (daySnap.exists()) reserved = daySnap.data().times;

      const conflict = selected.some(t => reserved.includes(t));
      if (conflict) {
        alert("Niektorá z vybraných hodín je už obsadená.");
        loadReserved(date);
        return;
      }

      await setDoc(dayRef, {
        times: [...reserved, ...selected],
        rezervacie: [...(daySnap.exists() ? daySnap.data().rezervacie : []), { name, phone, selected }]
      });
      alert("Rezervácia úspešne odoslaná!");
      loadReserved(date);
      e.target.reset();
    }

    window.addEventListener("DOMContentLoaded", () => {
      const form = document.getElementById("reservation-form");

      // hneď nastavíme dnešný dátum
      const today = new Date().toISOString().split("T")[0];
      form.date.value = today;
      loadReserved(today);

      form.addEventListener("submit", submitReservation);
      form.date.addEventListener("change", e => loadReserved(e.target.value));
    });
  </script>
  <style>
    body { font-family: Arial, sans-serif; background: #f2f2f2; }
    .container { max-width: 600px; margin: 30px auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
    th, td { border: 1px solid #ddd; padding: 10px; text-align: center; }
    th { background: #007BFF; color: white; }
    input, button { width: 100%; padding: 10px; margin: 5px 0; }
    button { background: #28a745; color: white; border: none; cursor: pointer; }
    button:hover { background: #218838; }
  </style>
</head>
<body>
  <div class="container">
    <h2>Rezervácia lyžiarskej školy</h2>
    <table>
      <thead>
        <tr>
          <th>Čas</th>
          <th>Rezervovať</th>
        </tr>
      </thead>
      <tbody id="times-body"></tbody>
    </table>

    <form id="reservation-form">
      <label for="name">Meno a priezvisko</label>
      <input type="text" id="name" required />

      <label for="phone">Telefón</label>
      <input type="text" id="phone" required />

      <label for="date">Dátum</label>
      <input type="date" id="date" required />

      <button type="submit">Rezervovať vybrané hodiny</button>
    </form>
  </div>
</body>
</html>
